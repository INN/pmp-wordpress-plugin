language: php

php:
    - "5.5"

sudo: false

env:
    - WP_VERSION=4.1.1 WP_TEST_DB_NAME=wordpress_tests WP_TEST_DB_USER=travis

install:
    - mkdir travis-phantomjs
    - wget https://s3.amazonaws.com/travis-phantomjs/phantomjs-2.0.0-ubuntu-12.04.tar.bz2 -O $PWD/travis-phantomjs/phantomjs-2.0.0-ubuntu-12.04.tar.bz2
    - tar -xvf $PWD/travis-phantomjs/phantomjs-2.0.0-ubuntu-12.04.tar.bz2 -C $PWD/travis-phantomjs
    - export PATH=$PWD/travis-phantomjs:$PATH

before_script:
    - mysql -e "CREATE DATABASE wordpress_tests;" -uroot
    - make wp-install
    - make wp-start
    - sleep 10
    - curl http://localhost:4000

after_script:
    - make wp-stop

script: make test

addons:
    artifacts:
        paths:
            - tests/_output
            - wptest/phantom.log
            - wptest/server.log

notifications:
    slack:
        secure: c8vhEs/7VUE/7/FCeBoWyoX+va5YS8S/afnTY7Hk/gUCAqXR+W3nmEGpfz4uzxFUTwhrynimV/9eyt560Y9BrvkNYLMTeDLgB/Otx5jBkuwthd6x9wcLEEup8NPAOj2/r9G0DFadOwSM76ME+H/5ySZ8L5YDOWyJsWR+BZ/MjlY=
